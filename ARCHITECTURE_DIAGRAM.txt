================================================================================
                    PROJECT-FRIDAY INTELLIGENCE SYSTEM
                          ARCHITECTURE OVERVIEW
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                          ORCHESTRATOR AGENT                                 │
│                    (orchestrator.py - Main Coordinator)                     │
│                                                                             │
│  Manages: Sub-agents, Safety Systems, Learning, Analytics                 │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                   ┌──────────────────┼──────────────────┐
                   │                  │                  │
                   ▼                  ▼                  ▼
        ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐
        │ INTELLIGENCE     │ │ SAFETY SYSTEMS   │ │ LEARNING SYSTEMS │
        │ PIPELINE         │ │                  │ │                  │
        │                  │ │ • Circuit Breaker│ │ • Pattern Learn  │
        │ • Hybrid System  │ │ • Retry Manager  │ │ • Calibration    │
        │ • Intent Class   │ │ • Error Handler  │ │ • Preference Mgr │
        │ • Entity Extract │ │ • Input Validate │ │ • Analytics      │
        │ • Task Decompose │ │                  │ │                  │
        │ • Confidence     │ │ (core/*.py)      │ │ (core/*.py)      │
        │ • Context Mgr    │ │                  │ │                  │
        │                  │ │                  │ │                  │
        │ (intelligence/*) │ │                  │ │                  │
        └────────┬─────────┘ └──────────────────┘ └──────────────────┘
                 │
    ┌────────────┴────────────────────────────────────────┐
    │                                                      │
    ▼                                                      ▼
┌───────────────────────────────────┐        ┌──────────────────────────┐
│  HYBRID INTELLIGENCE SYSTEM v5.0  │        │  CONTEXT & MEMORY SYSTEM │
│  (hybrid_system.py)               │        │                          │
│                                   │        │ • Conversation History   │
│  TWO-TIER ARCHITECTURE            │        │ • Entity Tracking        │
│                                   │        │ • Reference Resolution   │
│  TIER 1: FAST PATH (10ms)         │        │ • Pattern Learning       │
│  ┌─────────────────────────────┐  │        │ • Cache Layer (LRU+TTL)  │
│  │ Fast Keyword Filter         │  │        │                          │
│  │ • Regex pattern matching    │  │        │ (context_manager.py,     │
│  │ • Pre-compiled patterns     │  │        │  cache_layer.py)         │
│  │ • 95% accuracy for covered  │  │        │                          │
│  │ • 0 cost                    │  │        │                          │
│  │ • 35-40% coverage           │  │        └──────────────────────────┘
│  └──────────────┬──────────────┘  │
│                 │                  │
│         ┌───────┴────────┐         │
│         │                │         │
│    HIGH CONF?        NO? │         │
│         │                │         │
│        YES              │         │
│         │               │         │
│         ▼               ▼         │
│    Return      TIER 2: LLM PATH   │
│    Result      (~200ms, $0.01/1K) │
│                │                  │
│       ┌────────▼─────────┐        │
│       │ LLM Classifier   │        │
│       │ • Semantic caching        │
│       │ • Gemini Flash            │
│       │ • JSON parsing            │
│       │ • 70-80% cache hit rate   │
│       │ • 92% accuracy            │
│       └────────┬──────────┘        │
│               │                   │
│               └──────────┬────────┘
│                         │
└─────────────────────────┼──────────┘
                          │
        ┌─────────────────┴──────────────────┐
        │                                    │
        ▼                                    ▼
    ┌──────────────────┐          ┌──────────────────┐
    │ INTENT CLASSIFIER│          │ ENTITY EXTRACTOR │
    │ (intent_         │          │ (entity_         │
    │  classifier.py)  │          │  extractor.py)   │
    │                  │          │                  │
    │ Detects:         │          │ Recognizes:      │
    │ • CREATE         │          │ • Issues (KAN-123│
    │ • READ           │          │ • PRs (#123)     │
    │ • UPDATE         │          │ • Projects       │
    │ • DELETE         │          │ • People (@user) │
    │ • ANALYZE        │          │ • Teams          │
    │ • COORDINATE     │          │ • Channels       │
    │ • SEARCH         │          │ • Files          │
    │ • WORKFLOW       │          │ • Relationships  │
    │                  │          │ • Dates/Times    │
    │ Multi-intent     │          │ • Priorities     │
    │ detection        │          │ • Statuses       │
    │                  │          │                  │
    └──────────────────┘          └──────────────────┘
                │                          │
                └──────────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │ TASK DECOMPOSER      │
                    │ (task_decomposer.py) │
                    │                      │
                    │ Breaks down into:    │
                    │ • Individual tasks   │
                    │ • Dependency graphs  │
                    │ • Execution order    │
                    │ • Agent assignment   │
                    │ • Cost/time estim.   │
                    │ • Risk identification│
                    │                      │
                    └──────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │ CONFIDENCE SCORER    │
                    │ (confidence_         │
                    │  scorer.py)          │
                    │                      │
                    │ Bayesian scoring:    │
                    │ • Intent clarity     │
                    │ • Entity completeness│
                    │ • Message clarity    │
                    │ • Plan quality       │
                    │ • Entropy calc       │
                    │ • Decision theory    │
                    │                      │
                    │ Output: PROCEED /    │
                    │         CONFIRM /    │
                    │         CLARIFY      │
                    │                      │
                    └──────────┬───────────┘
                               │
                ┌──────────────┴──────────────┐
                │                             │
                ▼                             ▼
        [HIGH CONFIDENCE]           [MEDIUM/LOW CONFIDENCE]
        Execute directly            Ask user to confirm
        (Proceed)                   (Confirm) or
                                   (Clarify)


================================================================================
                            DATA FLOW EXAMPLE
================================================================================

Request: "Create a critical issue in KAN for the auth bug"

    1. HYBRID INTELLIGENCE
       ├─ Tier 1: Fast Filter detects "create" → CREATE (0.92 confidence)
       ├─ Confidence >= threshold → Return fast (HIGH PATH)
       └─ Result: CreateIntent, Priority=critical, Project=KAN

    2. ENTITY EXTRACTION
       ├─ Project: KAN (0.95)
       ├─ Priority: critical (0.95)
       ├─ Issue: [implied, will be created]
       └─ Description: auth bug

    3. CONTEXT MANAGER
       ├─ Store turn: [user message, intents, entities, timestamp]
       ├─ Track entities: KAN project, critical priority
       ├─ Update focus: [KAN, critical]
       └─ Learn pattern: {action: create, project: KAN, priority: critical}

    4. TASK DECOMPOSER
       ├─ Task 1: Get KAN project details
       ├─ Task 2: Create issue in KAN
       │   ├─ Inputs: title=auth bug, project=KAN, priority=critical
       │   └─ Outputs: issue_id, issue_url
       └─ Dependency: Task2 depends on Task1

    5. CONFIDENCE SCORER
       ├─ Intent clarity: 0.90 (single clear intent)
       ├─ Entity completeness: 0.85 (has all needed info)
       ├─ Message clarity: 0.85
       ├─ Plan quality: 0.80
       └─ Overall: 0.86 (HIGH) → CONFIRM WITH USER

    6. CIRCUIT BREAKER CHECK
       ├─ Check jira_agent health: CLOSED (healthy)
       └─ Allow execution

    7. EXECUTION
       ├─ Task 1: Get KAN details (success)
       ├─ Task 2: Create issue KAN-1234 (success)
       └─ Result: "Created issue KAN-1234: auth bug (Critical)"

    8. LEARNING UPDATE
       ├─ Pattern: {create, KAN, critical} → confidence +5%
       ├─ Cache result for future identical requests
       └─ Update context: Add KAN-1234 to focused entities


================================================================================
                        COMPONENT INTERACTION MATRIX
================================================================================

                    │ Hybrid │ Intent │ Entity │ Task  │ Confidence
                    │ System │ Class  │Extract│Decomp │ Scorer
────────────────────┼────────┼────────┼───────┼───────┼───────────
Hybrid System       │   -    │   ✓    │   ✓   │       │
Intent Classifier   │   ✓    │   -    │       │   ✓   │    ✓
Entity Extractor    │   ✓    │        │   -   │   ✓   │    ✓
Task Decomposer     │        │   ✓    │   ✓   │   -   │    ✓
Confidence Scorer   │   ✓    │   ✓    │   ✓   │   ✓   │    -
Context Manager     │   ✓    │   ✓    │   ✓   │       │    ✓
Circuit Breaker     │        │        │       │   ✓   │
Cache Layer         │   ✓    │   ✓    │   ✓   │   ✓   │

✓ = Component uses/interacts with


================================================================================
                         KEY METRICS & MONITORING
================================================================================

Hybrid Intelligence Metrics:
├─ Total requests processed
├─ Fast path: count, latency, accuracy
├─ LLM path: count, latency, cache hit rate
└─ Overall: avg latency, accuracy, cost

Cache Performance:
├─ Hit/miss ratio
├─ Evictions
├─ Expirations
└─ Size usage

Intent Classification:
├─ Total classifications
├─ Accuracy per intent type
├─ Multi-intent detection rate
└─ Implicit requirement detection

Entity Extraction:
├─ Total extractions
├─ Entities per message
├─ Relationships found
└─ Coreference resolution success

Task Decomposition:
├─ Tasks per request
├─ Dependency graph complexity
├─ Parallel task groups
└─ Cost/duration estimation accuracy

Confidence Scoring:
├─ Distribution of scores
├─ Calibration vs. actual accuracy
├─ Uncertainty levels
└─ User confirmation rates

Circuit Breaker:
├─ Per-agent state
├─ Failure/success rates
├─ State transitions
└─ Recovery time


================================================================================
                        PRODUCTION FEATURES
================================================================================

Safety & Reliability:
  ✓ Circuit Breaker Pattern (prevents cascading failures)
  ✓ Retry Manager (exponential backoff with jitter)
  ✓ Error Handler (comprehensive error classification)
  ✓ Input Validator (sanitization)
  ✓ Duplicate Detection (prevents duplicate operations)

Learning & Adaptation:
  ✓ Pattern Learning (learns from user behavior)
  ✓ Confidence Calibration (learns from historical data)
  ✓ Entity Confidence Adjustment
  ✓ User Preference Management
  ✓ Analytics Collection

Observability:
  ✓ Distributed Tracing
  ✓ Metrics Collection
  ✓ Structured Logging
  ✓ Session Logging
  ✓ Health Status Monitoring

Performance Optimization:
  ✓ Semantic Caching (70-80% hit rate)
  ✓ Two-Tier Hybrid System (balance speed/accuracy)
  ✓ Pattern Pre-compilation (fast path speed)
  ✓ Lazy Loading (agents loaded on demand)
  ✓ Parallel Task Execution (when possible)


================================================================================
